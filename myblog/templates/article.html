
{% load static %}


<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
     
     <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/fontawesome-free-6.6.0-web/css/all.css' %}">
    
<script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>

  <link rel="stylesheet" href="{% static 'css/acceuils.css' %}">
    <title>Document</title>
</head>
<body>


<style>

  body {
    margin: 0;
    padding: 0;

    background-color: rgb(250, 250, 250);
  }

  /* Header fixé en haut */
  .header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 1000;
    background-color: rgb(251, 248, 248);
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }

  /* Espace sous la navbar pour le contenu */
  body::before {
    content: "";
    display: block;
    height: 70px; /* même hauteur que la navbar */
  }

  .navbar {
    background-color:rgb(250, 250, 250)!important;
    padding: 5px
  }

  /* Style du bouton burger */
  .navbar-toggler {
    border: none;
    background: none;
    padding: 6px 10px;
  }

  .navbar-toggler i {
    font-size: 1.8rem;
    color: black;
  }

  /* Alignement du contenu */
  .s {
    display: flex;
    align-items: center;
    gap: 20px;
  }

  .s ul {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    gap: 20px;
  }

  .s ul li a {
    text-decoration: none;
    color: #333;
    font-weight: 500;
  }

  /* Effet hover */
  .s ul li a:hover {
    color: rgb(97, 97, 97);
    border-bottom: 2px solid #008C99;;
    padding-bottom: 5px;
    transition: 0.2s ease-in;
  }

  /* Responsive */
  @media (max-width: 900px) {
    .navbar-collapse {
      background-color: rgb(251, 248, 248);
      padding: 15px;
      border-radius: 10px;
    }

    .s {
      flex-direction: column;
      align-items: flex-start;
      gap: 15px;
    }

    /* Les éléments du menu deviennent verticaux */
    .s ul {
      flex-direction: column;
      width: 100%;
      gap: 10px;
    }

    .s ul li {
      width: 100%;
    }

    .s ul li a {
      display: block;
      width: 100%;
      padding: 8px 0;
      border-bottom: 1px solid #eee;
    }

    .s form {
      width: 100%;
    }
  }
</style>
</head>
<body>





<div class="header">
  <nav class="navbar navbar-expand-lg">
    <div class="container-fluid">

      <!-- Logo -->
      <a class="navbar-brand" href="#" style="color:rgb(4, 4, 4); font-weight:bold;"><img src="/static/images/1000061806-removebg-preview.png" alt="" width="100" height="100"></a>

      <!-- Bouton toggle -->
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
        data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
        aria-expanded="false" aria-label="Toggle navigation">
        <i class="fas fa-bars"></i>
      </button>

      <!-- Contenu -->
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="ms-auto s">
          <!-- Formulaire de recherche -->
          <form class="d-flex" role="search">
            <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
            <button class="btn btn-outline-success" type="submit"><i class="fas fa-search"></i></button>
          </form>

         <!-- Liens du menu -->
          <ul class="menus">
               <li><a href="{%  url 'acceuils'%}">  <i class="fas fa-home"></i>  <b>Acceuil</b></a></li>
            <li><a href="{%  url 'profils_user'%}">  <i class="fas fa-user"></i> <b>Profil</b></a></li>
         
            <li><a href="{% url 'myarticle' %}">  <i class="fas fa-box-open"></i> <b>Mes articles</b></a></li>
            <li><a href="{% url 'publier' %}">  <i class="fas fa-edit"></i>  <b>Publier un article</b></a></li>
        <li> <a href="{% url 'Deconexion'%}"> <i class="fa-solid fa-right-from-bracket"></i>  <b>Déconnexion</b> </a>  </li>
            
          </ul>
        </div>
      </div>

    </div>
  </nav>
</div>

<style>



  .navbar-brand img{
    text-align: start;
    
  }
  .menus{
    display: flex; gap:20px
  }
  .menus  a:hover{
    color:black;
  }
  .d-flex  .btn{
   
border: none;
color: #008C99;
  }
  .d-flex  .btn:hover{
    color: white;
border: none;
background-color: #008C99;
  }

 
    .d-flex   .form-control{
      border: 1px solid #008C99;;
    }

.d-flex   .form-control:focus{
box-shadow: none;
     
      border: 1px solid #008C99;;
  }
.sous-articles button i {
  color: #008C99;
 }
.sous-articles button {
  background-color:#e5e5e5;

}

.sous-articles {
    align-items: center;
    display: flex;
    justify-content: space-around;
}

.menus i{
  color: #008C99;
}

</style>


</body>

<div class="space"></div>


<div class="articles  ">

<div class=" ">







<div class="contenus  " >

  <div class="a">

<div class="contenus1">
  <br>
  <br>
  <br>
<a href="{% url 'acceuils' %}" ><i class="fa-solid fa-angle-left" style="font-size: 20px;color: #008C99;"></i></a>
<br>
<div class="post-header">
  <img class="profile-pic" src="{{ u.autheur.photo_user.url }}" alt="Photo de profil" style="border: 1px solid #008C99;;">
  <div class="info">
    <a href="{% url 'profils' id=u.autheur.id %}" class="username" style="  color:#008C99;">{{ u.autheur.username }}</a>
    <small class="date">{{ u.date_pub }}</small>
  </div>
</div>




</div>
<style>


  .post-header {
  display: flex;
  align-items: center;
  gap: 10px; /* espace entre la photo et le texte */
  margin-bottom: 10px;
}

.profile-pic {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  object-fit: cover;
}

.info {
  display: flex;
  flex-direction: column;
 
}
.info a:hover{

}

.username {
  font-weight: bold;
  text-decoration: none;
  color: black;
}

.username:hover {
  text-decoration: underline;
}

.date {
  color: black;
  font-size: 12px;
  margin-top: 2px;

}
</style>

<br>
<div class="contenus1  ">
  <h2 style="text-align: center;">{{u.titre}}</h2>



<p class="p1" >{{u.details }} </p>

<img src="{{ u.photo.url }}" alt="" width="100%" height="300px" style="border-radius:20px ;text-align:center ;  object-fit: cover;">
<br>
<br>


<div class="bn">

   
 <ul class="sous-articles">


<li><form action="{% url 'lik' %}" method="post" class="like-form" autocomplete="off">
    {% csrf_token %}
    <button type="submit" value="{{u.id}}" name="btn" id="like-icon-{{ u.id }}">
         <i class="fa-regular fa-heart"><small> {%  if u.likes.count != 0 %}  {{u.likes.count}}  {%endif%}   </small> </i>
    </button>
</form></li>

<li>
<div>  <BUtton > <a href="{% url   'article' id_article=u.id %}">    <i class="fa-regular fa-comment-dots">  <small> {%  if u.c.count != 0 %}  {{ u.c.count }}  {%endif%}   </small>  </i>  </a>  </BUtton></div></li>

</ul>
</div>
<hr>
<br>
<br>

<h5 style="font-weight: bold;">Commentaires</h5>
<br>

  
  {% for c in cmt%}
  
<div class="contenus3" >


  <div><img src="{{ c.user_cmt.photo_user.url }}" alt="" width="50" height="50" style="border-radius: 50%; border: 1px solid #008C99"></div> 
  <div ><p class="p2"><b><a href="{% url 'profils' id=c.user_cmt.id %}"> {{c.user_cmt.username}}  </a>   {%  if c.arti.id == c.user_cmt.id %}   <small style="margin-left: 1vh;" style="color: black;">       <i class="fa-solid fa-pencil" style="color: black;"></i>Auteur</small> {%endif%} </b>  <br>     {{c.commantaire}}</p>   <div class="c3"><small>{{c.date_cmt}} </small></div> 

<!-- ici la supression et la modifiction prend en compte deux parametre si mon id estr egal a lid du user presente dans les commentaire  via la cle id_user_cmt
 ou si lid de lautheur de larticle est egal a mon id sachant -->



  {% if id == c.user_cmt.id or id == c.arti.autheur.id %}
  <a href="{% url 'spp_cmt'   id_cmt=c.id %} " style="text-decoration: none; color:black"  >supprimer</a> |  <a href="{% url 'modifier'   id_cmt=c.id %}" style="text-decoration: none;  color:black;;" >modifier</a>
{%endif%}</div>






</div>

<br>

{% empty %}
<P>Aucun commentaire disponible pour le moment.</P>
{%endfor%}



<form action="{%  url 'article'  id_article=u.id %}" method="post" id="form" class="f" autocomplete="off">
{% csrf_token %}

<div class="formulaire">
  <div class="mb-3">


  <textarea class="form-control" id="cmt" rows="" placeholder="Laisser votre commentaire ici " name="commentaire"  required    >
</textarea>
</div>
<div> <button type="submit" class="btn" id="envoyer" ><i class="fas fa-paper-plane"></i></button></div>
 
</div>

</form>

<style>

</style>

{% if   messages %}
<form action="{%  url 'modifier'  id_cmt=request.session.d %}" method="post" id=""  class="f" autocomplete="off">


{% csrf_token %}
<div class="formulaire">
  <div class="mb-3">


<textarea class="form-control" id="cmt2" rows="" placeholder="" name="commentaire"  required>{% if   messages %}
{% for message in   messages %}{{message}}{%endfor%}

{%endif%}</textarea>
<div> <button type="submit" class="btn" id="envoyer2" style="margin-top: 1.5vh;" ><i class="fas fa-paper-plane"></i></button></div>
 
</div>

</form>
{%endif%}





<style>



</style>

</div>
</div>
</div>
</div>
</div>


<script>

const cmt =document.getElementById('cmt')
const cmt2 =document.getElementById('cmt2')

const envoyer =document.getElementById('envoyer')
const envoyer2 =document.getElementById('envoyer2')


cmt.addEventListener('input' , function(){
cmtvalue=cmt.value.trim()
if (cmtvalue !==""){
  envoyer.style.display='block'
} else{
    envoyer.style.display='none'
}
})



cmt2.addEventListener('input' , function(){
cmtvalue=cmt2.value.trim()
if (cmtvalue !==""){
  envoyer2.style.display='block'
} else{
    envoyer2.style.display='none'
}
})



</script>


{% if   messages %}
<script>
const form=document.getElementById('form')
form.style.display="none"
</script>
{%endif%}



<script>
function getCookie(name) {
  let cookieValue = null;
  if (document.cookie && document.cookie !== '') {
    const cookies = document.cookie.split(';');
    for (let cookie of cookies) {
      cookie = cookie.trim();
      if (cookie.startsWith(name + '=')) {
        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
        break;
      }
    }
  }
  return cookieValue;
}
const csrftoken = getCookie('csrftoken');

// Sélectionner tous les formulaires de like
document.querySelectorAll(".like-form").forEach(form => {
  form.addEventListener("submit", function(e) {
    e.preventDefault(); // empêche le rechargement

    const btn = this.querySelector("button[name='btn']");
    const articleId = btn.value;

    fetch("{% url 'lik' %}", {
      method: "POST",
      headers: {
        "X-CSRFToken": csrftoken,
        "X-Requested-With": "XMLHttpRequest",
        "Content-Type": "application/x-www-form-urlencoded"
      },
      body: `btn=${articleId}`
    })
    .then(res => res.json())
    .then(data => {
      // Met à jour le compteur dans le bouton
      btn.querySelector('small').textContent = " " + data.count;

      // Change la couleur de l'icône si liké
      btn.querySelector('i').style.color= data.liked ? '#008C99' : '#008C99';
    });
  });
});
</script>
