
{% load static %}


<!DOCTYPE html>
<html lang="fr">
<head>
  
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
       <link rel="stylesheet" href="{% static 'css/acceuils.css' %}">
     <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/fontawesome-free-6.6.0-web/css/all.css' %}">

<script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
    <title>Document</title>
</head>
<body>


<style>

  body {
    margin: 0;
    padding: 0;

    background-color: rgb(250, 250, 250);
  }

  /* Header fixé en haut */
  .header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 1000;
    background-color: rgb(251, 248, 248);
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }

  /* Espace sous la navbar pour le contenu */
  body::before {
    content: "";
    display: block;
    height: 70px; /* même hauteur que la navbar */
  }

  .navbar {
    background-color:rgb(250, 250, 250)!important;
    padding: 5px
  }

  /* Style du bouton burger */
  .navbar-toggler {
    border: none;
    background: none;
    padding: 6px 10px;
  }

  .navbar-toggler i {
    font-size: 1.8rem;
    color: black;
  }

  /* Alignement du contenu */
  .s {
    display: flex;
    align-items: center;
    gap: 20px;
  }

  .s ul {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    gap: 20px;
  }

  .s ul li a {
    text-decoration: none;
    color: #333;
    font-weight: 500;
  }

  /* Effet hover */
  .s ul li a:hover {
    color: rgb(97, 97, 97);
    border-bottom: 2px solid #008C99;;
    padding-bottom: 5px;
    transition: 0.2s ease-in;
  }

  /* Responsive */
  @media (max-width: 900px) {
    .navbar-collapse {
      background-color: rgb(251, 248, 248);
      padding: 10px;
      border-radius: 10px;
    }

    .s {
      flex-direction: column;
      align-items: flex-start;
      gap: 15px;
    }

    /* Les éléments du menu deviennent verticaux */
    .s ul {
      flex-direction: column;
      width: 100%;
      gap: 10px;
    }

    .s ul li {
      width: 100%;
    }

    .s ul li a {
      display: block;
      width: 100%;
      padding: 8px 0;
      border-bottom: 1px solid #eee;
    }

    .s form {
      width: 100%;
    }
  
     .d-flex  .form-control{
      width: 1000%;
        }
  }

   
</style>
</head>
<body>





<div class="header">
  <nav class="navbar navbar-expand-lg">
    <div class="container-fluid">

      <!-- Logo -->
      <a class="navbar-brand" href="{%  url 'acceuils'%}" style="color:rgb(4, 4, 4); font-weight:bold;"><img src="/static/images/1000061806-removebg-preview.png" alt="" width="100" height="100"></a>

      <!-- Bouton toggle -->
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
        data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
        aria-expanded="false" aria-label="Toggle navigation">
        <i class="fas fa-bars"></i>
      </button>

      <!-- Contenu -->
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="ms-auto s">
          <!-- Formulaire de recherche -->
          <form class="d-flex" role="search">
            <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search"  style="white-space:nowrap;">
            <button class="btn btn-outline-success" type="submit"><i class="fas fa-search"></i></button>
          </form>

          <!-- Liens du menu -->
          <ul class="menus">
               <li><a href="{%  url 'acceuils'%}">  <i class="fas fa-home"></i>  <b>Acceuil</b></a></li>
            <li><a href="{%  url 'profils_user'%}">  <i class="fas fa-user"></i> <b>Profil</b></a></li>
         
            <li><a href="{% url 'myarticle' %}">  <i class="fas fa-box-open"></i><b>Mes articles</b></a></li>
            <li><a href="{% url 'publier' %}">  <i class="fas fa-edit"></i><b>Publier un article</b></a></li>
        <li> <a href="{% url 'Deconexion'%}"> <i class="fa-solid fa-right-from-bracket"></i>   <b>Déconnexion</b> </a>  </li>
            
          </ul>
        </div>
      </div>

    </div>
  </nav>
</div>

<style>

  .navbar-brand img{
    text-align: start;
    
  }
  .menus{
    display: flex; gap:20px
  }
  .menus  a:hover{
    color:black;
  }
  .d-flex  .btn{
   
border: none;
color: #008C99;
  }
  .d-flex  .btn:hover{
    color: white;
border: none;
background-color: #008C99;
  }

 
    .d-flex   .form-control{
      border: 1px solid #008C99;;
    }

.d-flex   .form-control:focus{
box-shadow: none;
     
      border: 1px solid #008C99;;
  }
.menus i{
  color: #008C99;
}

</style>

<!-- Script Bootstrap -->


</body>

<br>
<br>
<br>


<style>
  .date {
  color: black;
  font-size: 12px;
  

}
</style>


<div class="space"></div>




<div class="articles ">



{% for u in user %}

<div class="blog">




  <div class="part2">
<div class="tete">
  <div>  <img src="{{ u.autheur.photo_user.url }}" alt="" width="40" height="40" style="border-radius: 50%; border:1px solid #008C99; ">  </div>
<div class="info">    <a href="{% url 'profils' id=u.autheur.id %}"  > {{u.autheur.username}}</a> <br>

<small class="date">   {{u.date_pub  }} </small>

</div>
</div>

<div>
<br>
  <div class="title">
 <strong>{{u.titre}}</strong> 

  </div>



<div class="about">
  <p class="p1" >  {{u.details|truncatechars:200 }} {% if u.details|length > 200 %} <a href="{% url   'article' id_article=u.id %}">Voir plus</a>  {%endif%}</p>
   <div class="sous-part1" id="s1">


      <div class="li_cm">
       <ul class="sous-ul" >
 <li>  <div>  <form action="{%  url 'acceuils' %}" method="post" class="like-form">  {% csrf_token  %} <BUtton type="submit" value="{{u.id}}" name="btn" id="like-icon-{{ u.id }}"><i class="fa-regular fa-heart"> <small> {%  if u.likes.count != 0 %}  {{u.likes.count}} {%endif%}   </small> </i>  </BUtton> </form></div> </li>
<li><div> <a href="{% url   'article' id_article=u.id %}"><i class="fa-regular fa-comment-dots">{% if u.c.count != 0 %} <small>{{ u.c.count }} </small> {%endif%}</i>  </a> </div></li>

</ul>

      </div>
      
    </div>
</div>





</div>


  


  </div>


    <div class="part1">
    <div class="image">
<img src="{{ u.photo.url }}" alt="" width="200" height="200" style="border-radius:20px ;">
    </div>
    <br>
    <div class="sous-part1" id="s2">


      <div class="li_cm">
       <ul class="sous-ul" >
 <li>  <div>  <form action="{%  url 'acceuils' %}" method="post" class="like-form">  {% csrf_token  %} <BUtton type="submit" value="{{u.id}}" name="btn" id="like-icon-{{ u.id }}"><i class="fa-regular fa-heart"> <small> {%  if u.likes.count != 0 %}  {{u.likes.count}} {%endif%}   </small> </i>  </BUtton> </form></div> </li>
<li><div> <a href="{% url   'article' id_article=u.id %}"><i class="fa-regular fa-comment-dots">{% if u.c.count != 0 %} <small>{{ u.c.count }} </small> {%endif%}</i>  </a> </div></li>

</ul>

      </div>
      
    </div>

    </div>


</div>

<style>
  #s2{
    display: none;
    
  }
  .modal .modal-content{
    background-color: rgb(233, 240, 233);
  }

</style>



<hr>





{% empty%}
<center><P>Aucun article publier pour le momeent</P></center>
{%endfor%}



</div>

<!-- Modal de succès -->
<div class="modal fade" id="successModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
  <div class="modal-dialog ">
    <div class="modal-content">
      <div class="modal-header">
   

      </div>
      <div class="modal-body">
  {% if messages%}

{% for message in messages %}
<b>{{message}}</b>



{%endfor%}
    {%endif%}


      </div>
      <div class="modal-footer">
      
      </div>
    </div>
  </div>
</div>



 

{% if messages %}
<script>
    // Cibler l'élément de la modale une seule fois
    const successModalElement = document.getElementById('successModal');
    
    // Vérifier si l'élément de la modale existe avant de continuer
    if (successModalElement) {
        
        // 1. Afficher la modale au chargement
        // Utiliser window.onload ou DOMContentLoaded pour s'assurer que l'élément existe.
        document.addEventListener('DOMContentLoaded', function () {
            // Créer l'instance Bootstrap de la modale
            const modalInstance = new bootstrap.Modal(successModalElement);
            
            // Afficher la modale
            modalInstance.show();

            // 2. Masquer la modale après 3 secondes
            setTimeout(function() {
                // Utiliser la méthode 'hide' de l'instance pour masquer la modale
                modalInstance.hide();
            }, 2000); // 3 secondes
        });
    }
</script>
{% endif %}






<script>
function getCookie(name) {
  let cookieValue = null;
  if (document.cookie && document.cookie !== '') {
    const cookies = document.cookie.split(';');
    for (let cookie of cookies) {
      cookie = cookie.trim();
      if (cookie.startsWith(name + '=')) {
        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
        break;
      }
    }
  }
  return cookieValue;
}
const csrftoken = getCookie('csrftoken');

// Sélectionner tous les formulaires de like
document.querySelectorAll(".like-form").forEach(form => {
  form.addEventListener("submit", function(e) {
    e.preventDefault(); // empêche le rechargement

    const btn = this.querySelector("button[name='btn']");
    const articleId = btn.value;

    fetch("{% url 'acceuils' %}", {
      method: "POST",
      headers: {
        "X-CSRFToken": csrftoken,
        "X-Requested-With": "XMLHttpRequest",
        "Content-Type": "application/x-www-form-urlencoded"
      },
      body: `btn=${articleId}`
    })
    .then(res => res.json())
    .then(data => {
      // Met à jour le compteur dans le bouton
      btn.querySelector('small').textContent = " " + data.count;

        
          btn.querySelector('i').style.background-color == data.liked ? '#008C99;' : '#008C99;';

  
    });
  });
});
</script>




<style>
  



.blog{

display: flex;
justify-content: center;
gap: 30PX;
  
}


.sous-part1 {



}


#s1 .sous-ul{

display: flex;
justify-content:start;
gap:20px
  
}
#s2 .sous-ul{

display: flex;
justify-content:end;
gap:20px
  
}
.sous-ul li{
background-color:#e5e5e5;
padding: 15px;
height: 20px;

border-radius: 10px;

  
}
.sous-part1 i{
    color: #008C99;
}

.sous-ul li i{
  color: #008C99;
}

button{
  border: none;
  background-color: transparent;
}
.tete{
  display: flex;
  align-items: center;
  gap: 10px;
}

a{
  color:#008C99;
  text-decoration: none;
  font-weight: bold;
}

 a:hover{
  color:#008C99;
  text-decoration: underline
}


.part2{
 max-height: 250px;;
}

/* ========================================= */
/* AJOUTS POUR LE RESPONSIVE DESIGN SEUL */
/* ========================================= */

.articles {
    /* Assure que l'espace est géré sur tous les écrans, y compris les petits */
    padding: 0 15px;
}

.blog {
    /* Ajout de la séparation entre articles et assure l'alignement */
    border-bottom: 1px solid #EEEEEE;
    padding: 25px 0; /* Espace vertical pour la séparation */
    align-items: flex-start;
}

/* --------------------------------- */
/* MEDIA QUERY : Écrans Moyens (Tablettes, jusqu'à 991px de large) */
/* --------------------------------- */
@media (max-width: 991px) {

    .blog {
        /* Maintient l'affichage flex, mais ajuste la répartition */
        gap: 20px;
        /* Peut ajuster les largeurs si nécessaire pour l'affichage côte-à-côte */
    }

    .part1 {
        /* L'image prend moins de place pour laisser plus d'espace au texte sur tablette */
        width: 40%;
        flex-shrink: 0; /* Empêche de rétrécir l'image trop */
    }

    .part2 {
        /* Le texte prend le reste de l'espace */
        width: 60%;
    }
}

/* --------------------------------- */
/* MEDIA QUERY : Petits Écrans (Mobiles, jusqu'à 767px de large) */
/* --------------------------------- */
@media (max-width: 500px) {

      #s2{
    display: block;
  }

      #s1{
    display: none;
  }

    .blog {
        /* Empilement vertical sur les mobiles */
        flex-direction: column;
        gap: 15px; /* Réduction du gap */
    }

    /* Le contenu (texte et image) prend 100% de la largeur du conteneur */
    .part1, .part2 {
        width: 100%;
    }

    /* L'image de l'article */
    .image img {
        width: 100%; /* L'image s'étend sur toute la largeur de l'écran */
        height: auto; /* Maintient le ratio d'aspect */
        max-height: 250px;
        object-fit: cover;
        border-radius: 10px; /* Réduction légère pour mobile */
    }

    .sous-part1 {
        /* Assure que les métadonnées (date/likes) restent bien espacées */
        margin-top: 10px;
    }
}

/* Correction de la taille de l'image pour qu'elle soit toujours responsive */
.image img {
    /* Surcharge le style inline (width: 450px) pour le rendre adaptatif par défaut */
    width: 100%;
    max-width: 450px; /* Limite la taille sur desktop */
    height: 200;

}





.sous-ul {
    /* Maintient les éléments sur une seule ligne */
    white-space: nowrap; 
    /* Assure que le conteneur des actions est flexible */
    display: flex; 
    align-items: center;
}

.sous-ul li {
    /* Assure que chaque élément li (bouton/lien) est aligné */
    display: flex;
    align-items: center;
    /* Important: empèche le texte du compteur de passer à la ligne */
    white-space: nowrap; 
}

.like-form, .sous-ul li button {
    /* Assure que le bouton lui-même est bien centré et compact */
    display: flex;
    align-items: center;
    padding: 0; /* Supprime tout padding inutile du bouton */
}

.sous-ul li i {
    /* Donne un petit espace entre l'icône et le chiffre */
    margin-right: 3px; 
}

.sous-ul small {
    /* S'assure que le chiffre est traité comme un élément de ligne */
    display: inline;
    /* Évite que le chiffre ne se divise sur plusieurs lignes */
    white-space: nowrap; 
}


/* Petit ajustement pour les petits écrans pour gagner de l'espace */
@media (max-width: 600px) {

        #s2{
    display: block;
  }

      #s1{
    display: none;
  }
    .sous-ul {
     ; /* Réduit l'espace entre les actions (Likes et Comments) */
    }
    
    .dte li {
        font-size: 0.85em; /* Réduit légèrement la taille de la date */
    }
}




.image img {
    /* Surcharge le style inline (width: 450px) pour le rendre adaptatif par défaut */
    width: 100%; /* L'image prend 100% de la largeur de son conteneur (.image) */
    
    /* FIX ESSENTIEL : Définir une hauteur fixe pour l'uniformité */
    height: 200px; /* J'ai ajouté l'unité 'px' qui manquait dans votre code. */
    
    /* PROPRIÉTÉ CLÉ : Assure que l'image couvre l'espace sans déformation */
    object-fit: cover; 

    /* Limite la largeur maximale pour l'affichage sur de grands écrans */
    max-width: 450px; 
    
    /* Ajouté pour s'assurer que l'image couvre bien son conteneur (si le HTML est bien fait) */
    display: block; 
}


/* Modification des styles existants pour le blog */
.blog {
    display: flex;
    /* FIX 1: Aligner les deux parties en haut (début) du conteneur */
    align-items: flex-start; 
    
    /* FIX 2: Utiliser space-between pour pousser les colonnes aux extrémités */
    /* REMARQUE : Si vous voulez qu'ils restent centrés, utilisez justify-content: center */
    /* Si vous voulez qu'ils soient espacés au maximum, utilisez: */
    justify-content: space-between; 
    
    gap: 30px; /* Conserver l'espace entre les colonnes */
    padding: 25px 0; /* Ajout d'un padding pour la visibilité */
    border-bottom: 1px solid #EEEEEE; /* Suggestion pour séparer les articles */
}

/* ------------------------------------------- */
/* AJOUTS POUR FIXER LES LARGEURS DES COLONNES */
/* ------------------------------------------- */

.blog > .part2 {
    /* La colonne Texte (gauche) */
    width: 60%; /* Fixer une largeur de travail pour le texte */
    /* Assure qu'elle ne soit pas plus petite que nécessaire */
    flex-shrink: 0; 
}

.blog > .part1 {
    /* La colonne Image et Métadonnées (droite) */
    width: 40%; /* Fixer une largeur pour l'image */
    /* Assure qu'elle ne soit pas plus petite que nécessaire */
    flex-shrink: 0; 
    
    /* FIX 3: Ajuster l'alignement vertical du contenu à l'intérieur de part1 */
    display: flex;
    flex-direction: column;
}

/* ------------------------------------------- */
/* AJUSTEMENTS ESSENTIELS DE L'IMAGE */
/* ------------------------------------------- */
.image img {
    /* Maintient l'uniformité de l'image (comme discuté précédemment) */
    width: 100% !important; 
    height: 200px !important; /* Utiliser une hauteur fixe */
    object-fit: cover;
    border-radius: 20px;
    max-width: none; /* Permet à width: 100% de fonctionner */
}

/* ------------------------------------------- */
/* RESPONSIVE (POUR MAINTENIR LE FORMAT SUR MOBILE) */
/* ------------------------------------------- */
@media (max-width: 600px) {
    .blog {
        /* Maintient le flex-direction: row même sur mobile */
        flex-wrap: wrap; /* Permet aux éléments de passer à la ligne si l'écran est vraiment trop petit */
        gap: 15px;
        /* Sur mobile, on empile si l'espace manque */
        flex-direction: column; 
        align-items: stretch;
    }
    
    .blog > .part2, .blog > .part1 {
        width: 100%; /* Prend toute la largeur sur mobile */
    }
}

</style>


